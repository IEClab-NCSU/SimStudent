/**
 * @fileoverview Provides CTAT functionality for SVG based components.
 * @author $Author$
 * @version $Revision$
 */
/*
 $Date$
 $HeadURL$

 -
 License:
 -
 ChangeLog:
 -
 Notes:

 TODO:
   DisabledBGColor
   DisabledBGTextColor
   label
   BorderStyle
   getText
   Font..., Align, Italic, Bold, Underline
   setEnabled (not sure if CompBase one is working with svg)
   Padding

   Remove SVG rect border and highlighting and use normal style options for
    it (to support transition to style sheets). Needs revamp of CTAT.Component.Base.Style
    so that this.style.boxSizing = 'border-box'; is not clobbered.
 */
goog.provide('CTAT.Component.Base.SVG');

goog.require('CTATGlobalFunctions');
goog.require('CTATGlobals');
goog.require('CTAT.Component.Base.Clickable');
//goog.require('CTAT.Geom.Rectangle');

/**
 * a component using svg for drawing.
 * @class
 * Uses SVG instead of Canvas. See:
 * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Basic_Shapes}
 * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element#Basic_shapes}
 *
 * Prototype for all complex components. Overrides all appropriate methods.
 * Every component has a border (what the user will see) and a base (the actual
 * rectangular area covered by the component). Both are the same width and
 * height as the surrounding SVG, which is the same width and height as the
 * surrounding div. Also contains methods to name elements when creating them.
 * @augments CTAT.Component.Base.Clickable
 */
CTAT.Component.Base.SVG = function(aClassName,
		aName,
		aDescription,
		aX,
		aY,
		aWidth,
		aHeight) {
	CTAT.Component.Base.Clickable.call(this,
			aClassName,
			aName,
			aDescription,
			aX,
			aY,
			aWidth,
			aHeight);

	var svg = null; // The svg node

	/*var precision = 3;//number of places to round decimals to
	this.getPrecision = function(){	return precision; };
	this.setPrecision = function(aPrec){ precision = aPrec; return this; };*/

	/**
	 * Initializes the component by setting up the svg node, the defs node for
	 * commonly used definitions, the border, and the background.
	 */
	this.initSVG = function() {
		this.setInitialized(true);
		// Common name space urls
		var svgNS = CTATGlobals.NameSpace.svg;
		var xmlns = CTATGlobals.NameSpace.xml;
		var xlinkNS = CTATGlobals.NameSpace.xlink;
		var evNS = CTATGlobals.NameSpace.ev;
		// generate everything in a fragment to minimize dom access.
		var svgFragment = document.createDocumentFragment();
		svg = document.createElementNS(svgNS,"svg"); // top svg node
		svgFragment.appendChild(svg);
		svg.classList.add('CTAT-gen-component');
		svg.classList.add('CTAT-svg');
		svg.classList.add('unselectable');
		svg.setAttributeNS(xmlns,"xmlns",svgNS);
		svg.setAttributeNS(xmlns,"xmlns:xlink",xlinkNS);
		svg.setAttributeNS(xmlns,"xmlns:ev",evNS);

		// set up defs child
		var defs = document.createElementNS(svgNS,"defs");
		svg.appendChild(defs);

		this.getDivWrap().appendChild(svgFragment);
		this.setComponent(svg);
	};
	/**
	 * Method for generating element names prefixed with the component's name.
	 * @param {String} suffix	the suffix to add to the base name.
	 * @returns {String} '"component name"_"suffix"'
	 */
	this.genName = function(suffix) {
		return this.getName() + "_" + suffix;
	};

	this.getBoundingBox = function() {
		//console.trace('CTATSVG w/h: '+[this.getWidth(),this.getHeight()].join(','));
		var bbox = new DOMRect(0,0,this.getWidth(),this.getHeight());
		var comp = this.getComponent();
		var cstyle = window.getComputedStyle(comp); // TODO: test if explorer supports this or is pointer.getComponent().currentStyle[''] needed.
		//console.trace('CTATSVG cw/h: '+[cstyle.width,cstyle.height].join(','));
		var padding = {
				left: parseInt(cstyle.getPropertyValue('padding-left')),
				top: parseInt(cstyle.getPropertyValue('padding-right')),
				bottom: parseInt(cstyle.getPropertyValue('padding-bottom')),
				right: parseInt(cstyle.getPropertyValue('padding-right'))
		};
		/*var margin = {
				left: parseInt(cstyle.getPropertyValue('margin-left')),
				top: parseInt(cstyle.getPropertyValue('margin-right')),
				bottom: parseInt(cstyle.getPropertyValue('margin-bottom')),
				right: parseInt(cstyle.getPropertyValue('margin-right'))
		};*/ //unnecessary
		var border = {
				left: parseInt(cstyle.getPropertyValue('border-left-width')),
				top: parseInt(cstyle.getPropertyValue('border-right-width')),
				bottom: parseInt(cstyle.getPropertyValue('border-bottom-width')),
				right: parseInt(cstyle.getPropertyValue('border-right-width'))
		};
		//console.log(padding);
		//console.log(border);
		bbox.width -= (padding.left+padding.right+border.left+border.right);
		bbox.height -= (padding.top+padding.bottom+border.top+border.bottom);
		//console.log(bbox);
		return bbox;
	};
};

CTAT.Component.Base.SVG.prototype = Object.create(CTAT.Component.Base.Clickable.prototype);
CTAT.Component.Base.SVG.prototype.constructor = CTAT.Component.Base.SVG;