/**
 * @fileoverview Unit tests for CTAT.Geom.Rectangle functions using qUnit.
 * @requires unit_test_util.js
 * @requires //code.jquery.com/qunit/qunit-1.17.1.js
 * @requires third-party/google/closure-library/closure/goog/base.js
 *
 * @author $Author$
 * @version $Revision$
 */
goog.require('CTAT.Geom.Rectangle');
goog.require('CTAT.Geom.Point');

QUnit.module("CTAT.Geom.Rectangle");
QUnit.test("new", function(assert) {
	// This test is mostly just a check that DOMRect works as expected.
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.x,5,'Check x is set.');
	assert.deepEqual(r.y,10,'Check y is set.');
	assert.deepEqual(r.width,15,'Check width is set');
	assert.deepEqual(r.height,20,'Check height is set');
	assert.deepEqual(r.left,5,'Check left is encoded.');
	assert.deepEqual(r.top,10,'Check top is encoded.');
	assert.deepEqual(r.right,20,'Check right is encoded');
	assert.deepEqual(r.bottom,30,'Check bottom is encoded');
	r = new DOMRect();
	assert.deepEqual(r.x,0,'Check x is set.');
	assert.deepEqual(r.y,0,'Check y is set.');
	assert.deepEqual(r.width,0,'Check width is set');
	assert.deepEqual(r.height,0,'Check height is set');
	r = new DOMRect(5,10,-5,-15);
	assert.deepEqual(r.x,5,'Check x is set.');
	assert.deepEqual(r.y,10,'Check y is set.');
	assert.deepEqual(r.width,-5,'Check width is set');
	assert.deepEqual(r.height,-15,'Check height is set');
	assert.deepEqual(r.left,0,'Check left is encoded.');
	assert.deepEqual(r.top,-5,'Check top is encoded.');
	assert.deepEqual(r.right,5,'Check right is encoded');
	assert.deepEqual(r.bottom,10,'Check bottom is encoded');
});
QUnit.test('x', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.x,5,'Check if x accessor works.');
});
QUnit.test('y', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.y,10,'Check if y accessor works.');
});
QUnit.test('left', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.left,5,'Check if left accessor works.');
});
QUnit.test('right', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.right,20,'Check if right accessor works.');
});
QUnit.test('top', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.top,10,'Check if top accessor works.');
});
QUnit.test('bottom', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.bottom,30,'Check if bottom accessor works.');
});
QUnit.test('width', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.width,15,'Check if width is calculated correctly.');
});
QUnit.test('height', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.height,20,'Check if height is calculated correctly.');
});
QUnit.test('clone', function(assert) {
	var r = new DOMRect(5,10,15,20);
	var r2 = r.clone();
	assert.deepEqual(r,r2,'Check if clone copied correctly.');
	r2.x = 0;
	assert.notDeepEqual(r,r2,'Check that clone is independent of origional.');
});
QUnit.test('contains(x,y)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.ok(r.contains(10,15),'Check if fully inside point passes.');
	assert.ok(r.contains(5,10),'Check if topLeft is inside.');
	assert.ok(r.contains(5,15),'Check if point on left edge is inside.');
	assert.ok(r.contains(5,20),'Check if bottomLeft is inside.');
	assert.ok(r.contains(20,10),'Check if topRight is inside.');
	assert.ok(r.contains(20,15),'Check if point on right edge is inside.');
	assert.ok(r.contains(20,30),'Check if bottomRight is inside.');
	assert.ok(!r.contains(0,0),'Check if point less than x,y is outside.');
	assert.ok(!r.contains(5,0),'Check if point less than y is outside.');
	assert.ok(!r.contains(0,10),'Check if point less than x is outside.');
	assert.ok(!r.contains(50,50),'Check if point greater than bottomRight is outside.');
	assert.ok(!r.contains(30,15),'Check if point greater than right is outside.');
	assert.ok(!r.contains(15,0),'Check if point greater than left and less than top is outside.');
	assert.ok(!r.contains(15,50),'Check if point greater than left and more than bottom is outside.');
});
QUnit.test('contains(DOMPoint)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	// these tests repeat the tests in contains
	assert.ok(r.contains(new DOMPoint(10,15)));
	assert.ok(r.contains(new DOMPoint(5,10)));
	assert.ok(r.contains(new DOMPoint(5,15)));
	assert.ok(r.contains(new DOMPoint(5,20)));
	assert.ok(r.contains(new DOMPoint(20,10)));
	assert.ok(r.contains(new DOMPoint(20,15)));
	assert.ok(r.contains(new DOMPoint(20,30)));
	assert.ok(!r.contains(new DOMPoint(0,0)));
	assert.ok(!r.contains(new DOMPoint(5,0)));
	assert.ok(!r.contains(new DOMPoint(0,10)));
	assert.ok(!r.contains(new DOMPoint(50,50)));
	assert.ok(!r.contains(new DOMPoint(30,15)));
	assert.ok(!r.contains(new DOMPoint(15,0)));
	assert.ok(!r.contains(new DOMPoint(15,50)));
});
QUnit.test('contains(DOMRect)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.ok(r.contains(r),'rectangle contains itself.');
	assert.ok(r.contains(new DOMRect(6,11,10,15)),'Rectangle contains a fully contained rectangle.');
	assert.ok(!r.contains(new DOMRect(0,11,10,15)),'does not contain a rectangle that crosses left.');
	assert.ok(!r.contains(new DOMRect(6,0,10,15)),'does not contain a rectangle that crosses top.');
	assert.ok(!r.contains(new DOMRect(6,11,30,15)),'does not contain a rectangle that crosses right.');
	assert.ok(!r.contains(new DOMRect(6,11,10,30)),'does not contain a rectangle that crosses bottom.');
	assert.ok(!r.contains(new DOMRect(0,0,50,50)),'does not contain a rectangle that surrounds it.');
	assert.ok(!r.contains(new DOMRect(0,0,3,3)),'does not contain a rectangle that has no intersection');
	assert.ok(!r.contains(new DOMRect(50,50,3,3)),'does not contain a rectangle that has no intersection');
	assert.ok(!r.contains(new DOMRect(7,0,3,3)),'does not contain a rectangle that has no intersection');
	assert.ok(!r.contains(new DOMRect(0,13,3,3)),'does not contain a rectangle that has no intersection');
});
QUnit.test('contains(DOMPoint,radius)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.ok(r.contains(new DOMPoint(10,15),5),'Circle touching left and right edges.');
	assert.ok(r.contains(new DOMPoint(10,15),2), 'Circle well withing rectangle.');
	assert.ok(!r.contains(new DOMPoint(5,15),5), 'Circle bisected by left edge.');
	assert.ok(!r.contains(new DOMPoint(10,15),15), 'Circle bigger than rectangle.');
	assert.ok(!r.contains(new DOMPoint(25,15),5), 'Circle to right of rectangle.');
	assert.ok(!r.contains(new DOMPoint(10,0),5), 'Circle aboce rectangle');
	assert.ok(!r.contains(new DOMPoint(10,32),5),'Circle overlaps bottom edge');
	assert.ok(!r.contains(new DOMPoint(5,10),5), 'Circling top left corner');
});
QUnit.test('<DOMRect>.copyFrom', function(assert) {
	var r = new DOMRect(5,10,15,20);
	var rc = r.clone();
	var rf = new DOMRect(0,0,3,3);
	assert.deepEqual(r,rc,'Check that origional and clone are equal.');
	r.copyFrom(rf);
	assert.deepEqual(r,rf,'Check that it matches new values.');
	assert.notDeepEqual(r,rc,'Check that it changed.');
});
QUnit.test('equals', function(assert) {
	var r = new DOMRect(5,10,15,20);
	var rc = r.clone();
	assert.ok(CTAT.Geom.Rectangle.equals(r,rc));
	rc.x = 0; // modify one of them
	assert.ok(!CTAT.Geom.Rectangle.equals(r,rc));

});
QUnit.test('inflate(x,y)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(CTAT.Geom.Rectangle.inflate(r,5,5),new DOMRect(0,5,25,30));
});
QUnit.test('inflate(Point)', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(CTAT.Geom.Rectangle.inflate(r,new DOMPoint(5,5)),new DOMRect(0,5,25,30));
});
/*QUnit.test('intersection', function(assert) {
	var Rect = CTAT.Geom.Rectangle;
	var r = new Rect(5,10,15,20);

});
QUnit.test('intersects', function(assert) {
	var Rect = CTAT.Geom.Rectangle;
	var r = new Rect(5,10,15,20);

});*/
QUnit.test('isEmpty', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.ok(!CTAT.Geom.Rectangle.isEmpty(r));
	assert.ok(CTAT.Geom.Rectangle.isEmpty(new DOMRect()));
	assert.ok(CTAT.Geom.Rectangle.isEmpty(new DOMRect(1,2,0,3)));
	assert.ok(CTAT.Geom.Rectangle.isEmpty(new DOMRect(1,2,3,0)));
});
QUnit.test('offset(x,y)', function(assert) { // TODO: more cases, positive values, 0, etc.
	var offset = CTAT.Geom.Rectangle.offset;
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(offset(r,-5,-10),new DOMRect(0,0,15,20));
	assert.deepEqual(r,new DOMRect(5,10,15,20),'Test for non-destructive nature.');
});
QUnit.test('offset(DOMPoint)', function(assert) {
	var offset = CTAT.Geom.Rectangle.offset;
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(offset(r,new DOMPoint(-5,-10)),new DOMRect(0,0,15,20));
	assert.deepEqual(r,new DOMRect(5,10,15,20),'Test for non-destructive nature.');
});
QUnit.test('setEmpty', function(assert) {
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(CTAT.Geom.Rectangle.setEmpty(r),new DOMRect());
	assert.deepEqual(r,new DOMRect(),'Test for destructive nature.');
});
QUnit.test('setTo', function(assert) {
	var r = new DOMRect(5,10,15,20);
	var rr = new DOMRect(0,1,3,5);
	assert.deepEqual(CTAT.Geom.Rectangle.setTo(r,0,1,3,5),rr);
	assert.deepEqual(r,rr,'Test for destructive nature.');
});
/*QUnit.test('toString', function(assert) {
	//var Rect = CTAT.Geom.Rectangle;
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(r.toString(),'Rectangle(x:5,y:10,w:15,h:20)');
});*/
QUnit.test('union', function(assert) { // TODO: more cases
	var union = CTAT.Geom.Rectangle.union;
	var r = new DOMRect(5,10,15,20);
	assert.deepEqual(union(r,new DOMRect(0,0,3,3)),new DOMRect(0,0,20,30));
	assert.deepEqual(union(r,r),r);
	assert.deepEqual(union(r,new DOMRect(30,40,10,10)),new DOMRect(5,10,35,40));
});


