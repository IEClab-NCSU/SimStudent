/**-----------------------------------------------------------------------------
 $Author$
 $Date$
 $HeadURL$
 $Revision$

 -
 License:
 -
 ChangeLog:
 -
 Notes:

 */
goog.provide('CTATGroupingComponent');

goog.require('CTATGlobalFunctions');
goog.require('CTAT.Component.Base.SAIHandler');
goog.require('CTAT.ComponentRegistry');
/**
 *
 */
CTATGroupingComponent = function(aDescription,aX,aY,aWidth,aHeight)
{
	CTAT.Component.Base.SAIHandler.call(this,
			"CTATGroupingComponent",
			"__undefined__",
			aDescription,
			aX,
			aY,
			aWidth,
			aHeight);

	var pointer=this;

	var parentExecuteSAI=pointer.executeSAI;  // save superclass method since needed override below

	this.isTabIndexable=false;

	/**
	 *
	 */
	//this.scrollToHighlighted = function() {
	//	return CTATGlobalFunctions.stringToBoolean(
	//			pointer.getDivWrap().getAttribute("data-ctat-scroll-to-highlighted"));
	//};
	/**
	 * Get an array of of CTATComponents that are "controlled" by this grouping
	 * component.  These are either children of the component or listed in the
	 * data-ctat-componentlist attribute.
	 * @returns an array of CTATComponents.
	 */
	this.getComponentList = function() {
		var clist = [];
		var comps = pointer.getDivWrap().getAttribute('data-ctat-componentlist');
		if (comps) {
			clist = comps.split(/\s*[,;]\s*/).map(i=>$('#'+i.trim()).data('CTATComponent'));
		}
		var $p = $(pointer.getDivWrap());
		$p.children('.CTATComponent').each(function() {
			clist.push($(this).data('CTATComponent'));
		});
		return [...new Set(clist)];
	};
	/**
	 * Initialization function.  This is required.
	 */
	this.init=function init()
	{
		pointer.setInitialized (true);
	};

	/**
	 * Override executeSAI so that SAI's are distributed to the components
	 * in the group.
	 * @param aSAI: a SAI.
	 */
	this.executeSAI = function(aSAI) {
		pointer.getComponentList().forEach(function(comp) {
			if (comp != null) comp.executeSAI(aSAI);
		});
		parentExecuteSAI.call(pointer, aSAI);
	};
};

CTATGroupingComponent.prototype = Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATGroupingComponent.prototype.constructor = CTATGroupingComponent;

CTAT.ComponentRegistry.addComponentType('CTATGroupingComponent',CTATGroupingComponent);
