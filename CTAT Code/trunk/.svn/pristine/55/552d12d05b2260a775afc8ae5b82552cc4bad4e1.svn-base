/**-----------------------------------------------------------------------------
 $Author$
 $Date$
 $HeadURL$
 $Revision$

 -
 License:
 -
 ChangeLog:
 -
 Notes:
 */
goog.provide('CTATTextArea');

goog.require('CTATGlobalFunctions');
goog.require('CTATTextBasedComponent');
goog.require('CTAT.ComponentRegistry');
/**
 *
 */
CTATTextArea = function(aDescription,
						aX,
						aY,
						aWidth,
						aHeight)
{
	CTATTextBasedComponent.call(this,
					  			"CTATTextArea",
					  			"__undefined__",
					  			aDescription,
					  			aX,
					  			aY,
					  			aWidth,
					  			aHeight);

	this.setDefaultWidth (100);
	this.setDefaultHeight (44);

	var pointer=this;
	var textinput=null;
	var cellContainer=null
	var previewMode = CTATConfiguration.get('previewMode');

	this.setAction('UpdateTextArea');

	/**
	 * @param {boolean} isTableCell true if this component is a cell in a CTATTable
	 */
	this.init=function init(isTableCell)
	{
	    textinput=document.createElement("textarea");
	    if (aDescription)
		{
	    	textinput.name=aDescription.name;
		}
	    // textinput.setAttribute('maxlength', pointer.getMaxCharacters());
	    textinput.setAttribute('id', CTATGlobalFunctions.gensym.div_id());
	    //textinput.setAttribute('onkeypress', 'return noenter(event)');
	    //textinput.classList.add('CTAT-text'); // removed as it is apparently not used #919
		var divWrap = this.getDivWrap();
		if (divWrap && $(divWrap).attr('maxlength'))
			textinput.maxlength = $(divWrap).attr('maxlength');
		if (divWrap && $(divWrap).attr('rows'))
			textinput.rows = $(divWrap).attr('rows');
		if (divWrap && $(divWrap).attr('cols'))
			textinput.cols = $(divWrap).attr('cols');

		pointer.setComponent(textinput);
		
		if (divWrap && $(divWrap).attr('value'))
			this.setText($(divWrap).attr('value'));
		else
			textinput.value=this.getText();
		
	    pointer.setInitialized(true);

	    pointer.addComponentReference(pointer, textinput);

	    divWrap.appendChild(textinput);
		
	    //pointer.render();

	    $(textinput).keypress(pointer.processKeypress);
	    //textinput.addEventListener('blur', pointer.processBlur); // causes double processAction
		textinput.addEventListener('focus', pointer.processFocus);
	    $(textinput).on('input', function (e) { pointer.setNotGraded(); });

		if (previewMode)
			this.addEventScreen(false);
	};
	this.processBlur = function(e) {
		pointer.processAction();
	};

	this.setCellContainer=function setCellContainer(aContainer)
	{
		cellContainer=aContainer;
	};

	this.getCellContainer=function getCellContainer()
	{
		return (cellContainer);
	};

	/**
	 *
	 */
	this.setText = function setText(aText)
	{
	    pointer.ctatdebug("setText (" + aText + ")");
	    //console.log(this.getName(),'setText',aText);

 		pointer.assignText(aText);
 		textinput.value=aText;

 		// this.redraw (); // Very very experimental
	};

	this.getValue = function () {
		return textinput.value;
	};

	this.reset=function reset ()
	{
		pointer.configFromDescription();
		pointer.processSerialization();
		textinput.value="";
	};
};

CTATTextArea.prototype = Object.create(CTATTextBasedComponent.prototype);
CTATTextArea.prototype.constructor = CTATTextArea;

CTAT.ComponentRegistry.addComponentType('CTATTextArea', CTATTextArea);